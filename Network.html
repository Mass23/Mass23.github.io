<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Word Network Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    svg { width: 100vw; height: 100vh; display: block; }

    .node rect { fill: #aaa; stroke: #333; rx: 8; ry: 8; }
    .node text { 
      pointer-events: none; 
      font-family: Menlo, monospace;
      font-weight: normal;
      font-style: normal;
      font-size: 16px;
    }

    .link { stroke: #999; stroke-opacity: 0.6; }

    .highlight-node rect { fill: orange !important; }
    .highlight-link { stroke: orange !important; stroke-width: 2px; }

    .hover-label text {
      font-family: Arial, sans-serif;
      font-weight: bold;
      font-style: italic;
      font-size: 40px;
      fill: orange;
      pointer-events: none;
    }

    .hover-label circle {
      stroke: orange;
      stroke-width: 4px;
      fill: none;
      pointer-events: none;
    }
  </style>
</head>
<body>
<svg></svg>

<script>
const svg = d3.select("svg");
let width = window.innerWidth;
let height = window.innerHeight;

// Sample Data
const nodes = [
  { id: "apple", cluster: ["fruit"] },
  { id: "banana", cluster: ["fruit"] },
  { id: "carrot", cluster: ["vegetable"] },
  { id: "orange", cluster: ["fruit", "color"] }
];

const links = [
  { source: "apple", target: "banana" },
  { source: "banana", target: "orange" },
  { source: "orange", target: "carrot" }
];

// Cluster Colors
const clusterColors = {
  fruit: "orange",
  vegetable: "green",
  color: "blue"
};

// Make the network more spread out
let simulation = d3.forceSimulation(nodes)
  .force("link", d3.forceLink(links).id(d => d.id).distance(250))
  .force("charge", d3.forceManyBody().strength(-600))
  .force("center", d3.forceCenter(width / 2, height / 2));

// Draw links
const link = svg.append("g")
  .selectAll("line")
  .data(links)
  .join("line")
  .attr("class", "link");

// Draw nodes
const node = svg.append("g")
  .selectAll("g")
  .data(nodes)
  .join("g")
  .attr("class", "node")
  .on("mouseover", function(event, d) {
      const targetClusters = d.cluster;
      const clusterName = targetClusters[0];
      const color = clusterColors[clusterName] || "orange";

      node.classed("highlight-node", n => n.cluster.some(c => targetClusters.includes(c)));
      link.classed("highlight-link", l =>
         l.source.cluster.some(c => targetClusters.includes(c)) &&
         l.target.cluster.some(c => targetClusters.includes(c))
      );

      hoverLabel.select("circle")
        .attr("r", 140)                   // Bigger circle!
        .attr("stroke", color)
        .style("display", "block");

      hoverLabel.select("text")
        .text(clusterName)
        .attr("fill", color)
        .attr("x", 0)
        .attr("y", 170)                  // Text outside of big circle
        .style("display", "block");
  })
  .on("mouseout", function() {
      node.classed("highlight-node", false);
      link.classed("highlight-link", false);
      hoverLabel.select("circle").style("display", "none");
      hoverLabel.select("text").style("display", "none");
  });

// Bigger square node shapes
node.append("rect")
  .attr("width", 140)
  .attr("height", 50)
  .attr("x", -70)
  .attr("y", -25);

node.append("text")
  .text(d => d.id)
  .attr("text-anchor", "middle")
  .attr("dy", "0.35em");

// Hover Circle + Cluster Label
const hoverLabel = svg.append("g")
  .attr("class", "hover-label")
  .style("pointer-events", "none");

hoverLabel.append("circle").style("display", "none");
hoverLabel.append("text")
  .attr("text-anchor", "middle")
  .attr("dy", "0.35em")
  .style("display", "none");

// Make the hover label follow the mouse
svg.on("mousemove", function(event) {
  const [x, y] = d3.pointer(event);
  hoverLabel.attr("transform", `translate(${x},${y})`);
});

// Force layout updates positions
simulation.on("tick", () => {
  link
      .attr("x1", d => d.source.x)
      .attr("y1", d => d.source.y)
      .attr("x2", d => d.target.x)
      .attr("y2", d => d.target.y);

  node
      .attr("transform", d => `translate(${d.x},${d.y})`);
});

// Handle window resize and recenter
window.addEventListener('resize', () => {
  width = window.innerWidth;
  height = window.innerHeight;
  simulation.force("center", d3.forceCenter(width / 2, height / 2));
  simulation.alpha(0.5).restart();
});
</script>
</body>
</html>
