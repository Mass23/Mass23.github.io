<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Word Network â€” Hover Highlight</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    svg { width: 100vw; height: 100vh; display: block; }

    .node rect {
      fill: #aaa;
      stroke: #333;
      rx: 8;
      ry: 8;
      cursor: pointer;
    }

    .node text {
      pointer-events: none;
      font-family: Menlo, monospace;
      font-size: 16px;
    }

    .link {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .highlighted-node rect {
      fill: orange;
    }

    .highlighted-link {
      stroke: orange;
      stroke-opacity: 1;
      stroke-width: 3;
    }

    .cluster circle {
      fill: none;
      stroke-width: 4px;
    }

    .cluster-labels {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.8);
      padding: 10px;
      border-radius: 8px;
      font-family: Arial, sans-serif;
      font-weight: bold;
      font-style: italic;
      font-size: 20px;
    }

    .cluster-labels div {
      margin: 4px 0;
      cursor: pointer;
    }

    .cluster-labels div:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<div class="cluster-labels" id="clusterMenu"></div>
<svg></svg>

<script>
const svg = d3.select("svg");
let width = window.innerWidth;
let height = window.innerHeight;

const nodes = [
  { id: "apple", cluster: ["fruit"], url: "https://en.wikipedia.org/wiki/Apple" },
  { id: "banana", cluster: ["fruit"], url: "https://en.wikipedia.org/wiki/Banana" },
  { id: "carrot", cluster: ["vegetable"], url: "https://en.wikipedia.org/wiki/Carrot" },
  { id: "orange", cluster: ["fruit", "color"], url: "https://en.wikipedia.org/wiki/Orange_(fruit)" },
  { id: "blue", cluster: ["color"], url: "https://en.wikipedia.org/wiki/Blue" }
];

const links = [
  { source: "apple", target: "banana" },
  { source: "banana", target: "orange" },
  { source: "orange", target: "carrot" },
  { source: "orange", target: "blue" }
];

const clusterColors = {
  fruit: "orange",
  vegetable: "green",
  color: "blue"
};

// === Preprocess cluster groups ===
const clusterGroups = {};
nodes.forEach(node => {
  node.cluster.forEach(cluster => {
    if (!clusterGroups[cluster]) clusterGroups[cluster] = [];
    clusterGroups[cluster].push(node);
  });
});

// === Force Simulation ===
const simulation = d3.forceSimulation(nodes)
  .force("link", d3.forceLink(links).id(d => d.id).distance(250))
  .force("charge", d3.forceManyBody().strength(-600))
  .force("center", d3.forceCenter(width / 2, height / 2));

// === Draw Links ===
const link = svg.append("g")
  .selectAll("line")
  .data(links)
  .join("line")
  .attr("class", "link");

// === Draw Nodes ===
const node = svg.append("g")
  .selectAll("g")
  .data(nodes)
  .join("g")
  .attr("class", "node")
  .on("click", function(event, d) {
    if (d.url) window.open(d.url, '_blank');
  });

node.append("rect")
  .attr("width", 140)
  .attr("height", 50)
  .attr("x", -70)
  .attr("y", -25);

node.append("text")
  .text(d => d.id)
  .attr("text-anchor", "middle")
  .attr("dy", "0.35em");

// === Cluster Circle Layer ===
const clusterLayer = svg.append("g").attr("class", "clusters");

// === Draw Menu for Clusters ===
const menu = d3.select("#clusterMenu");
Object.keys(clusterGroups).forEach(cluster => {
  menu.append("div")
    .text(cluster)
    .style("color", clusterColors[cluster] || "black")
    .on("mouseover", () => highlightCluster(cluster))
    .on("mouseout", () => clearHighlight());
});

function highlightCluster(cluster) {
  const selectedNodes = new Set(clusterGroups[cluster].map(d => d.id));

  node.classed("highlighted-node", d => selectedNodes.has(d.id));
  link.classed("highlighted-link", d => 
    selectedNodes.has(d.source.id) && selectedNodes.has(d.target.id)
  );

  // Draw circle around cluster
  const members = clusterGroups[cluster];
  const xs = members.map(n => n.x);
  const ys = members.map(n => n.y);
  const minX = Math.min(...xs);
  const maxX = Math.max(...xs);
  const minY = Math.min(...ys);
  const maxY = Math.max(...ys);
  const centerX = (minX + maxX) / 2;
  const centerY = (minY + maxY) / 2;
  const radius = Math.max((maxX - minX) / 2, (maxY - minY) / 2) + 80;

  const clusterData = [{ name: cluster, x: centerX, y: centerY, r: radius }];

  const circles = clusterLayer.selectAll("g.cluster")
    .data(clusterData, d => d.name);

  const gEnter = circles.enter()
    .append("g")
    .attr("class", "cluster");

  gEnter.append("circle")
    .attr("stroke", d => clusterColors[d.name] || "gray");

  gEnter.append("text")
    .text(d => d.name);

  const merged = gEnter.merge(circles);

  merged.select("circle")
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .attr("r", d => d.r)
    .attr("stroke", d => clusterColors[d.name] || "gray");

  merged.select("text")
    .attr("x", d => d.x - d.r + 15)
    .attr("y", d => d.y - d.r + 30)
    .attr("fill", d => clusterColors[d.name] || "gray");
}

function clearHighlight() {
  node.classed("highlighted-node", false);
  link.classed("highlighted-link", false);
  clusterLayer.selectAll("g.cluster").remove();
}

// === Simulation Tick Update ===
simulation.on("tick", () => {
  link
    .attr("x1", d => d.source.x)
    .attr("y1", d => d.source.y)
    .attr("x2", d => d.target.x)
    .attr("y2", d => d.target.y);

  node
    .attr("transform", d => `translate(${d.x},${d.y})`);
});

// === Handle Window Resize ===
window.addEventListener('resize', () => {
  width = window.innerWidth;
  height = window.innerHeight;
  simulation.force("center", d3.forceCenter(width / 2, height / 2));
  simulation.alpha(0.5).restart();
});
</script>
</body>
</html>
